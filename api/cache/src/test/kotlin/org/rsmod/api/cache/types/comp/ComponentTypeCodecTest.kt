package org.rsmod.api.cache.types.comp

import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Test
import org.rsmod.api.cache.types.testBuf
import org.rsmod.game.type.comp.UnpackedComponentType

class ComponentTypeCodecTest {
    @Test
    fun `encode and decode v1`() {
        val type = componentTypeV1()
        val encoded = testBuf().apply { ComponentTypeEncoder.encode(type, this) }
        val decoded = ComponentTypeDecoder.decode(type.packed, encoded).build(type.packed)
        assertEquals(type, decoded)
    }

    @Test
    fun `encode and decode v3`() {
        val type = componentTypeV3()
        val encoded = testBuf().apply { ComponentTypeEncoder.encode(type, this) }
        val decoded = ComponentTypeDecoder.decode(type.packed, encoded).build(type.packed)
        assertEquals(type, decoded)
    }

    private fun componentTypeV1(): UnpackedComponentType =
        UnpackedComponentType(
            internalName = "null",
            internalId = 589853,
            v3 = false,
            type = 4,
            buttonType = 0,
            contentType = 0,
            x = 335,
            y = 72,
            width = 90,
            height = 32,
            trans1 = 0,
            layer = -1,
            mouseOverRedirect = -1,
            cs1Comparisons = null,
            cs1ComparisonValues = null,
            cs1Instructions = arrayOf(intArrayOf(14, 231, 0)),
            scrollHeight = 0,
            hide = false,
            fill = false,
            textAlignH = 1,
            textAlignV = 1,
            textLineHeight = 0,
            textFont = 497,
            textShadow = false,
            secondaryText = "",
            colour1 = 16777215,
            colour2 = 0,
            mouseOverColour1 = 0,
            mouseOverColour2 = 0,
            graphic = -1,
            secondaryGraphic = -1,
            modelKind = 1,
            model = -1,
            secondaryModelKind = 1,
            secondaryModel = -1,
            modelAnim = -1,
            secondaryModelAnim = -1,
            modelZoom = 100,
            modelAngleX = 0,
            modelAngleY = 0,
            text = "DEATH",
            targetVerb = "",
            targetBase = "",
            events = 0,
            buttonText = "Ok",
            widthMode = 0,
            heightMode = 0,
            xMode = 0,
            yMode = 0,
            scrollWidth = 0,
            noClickThrough = false,
            angle2d = 0,
            tiling = false,
            outline = 0,
            graphicShadow = 0,
            vFlip = false,
            hFlip = false,
            modelX = 0,
            modelY = 0,
            modelAngleZ = 0,
            modelOrthog = false,
            modelObjWidth = 0,
            lineWid = 1,
            lineDirection = false,
            opBase = "",
            op = emptyArray(),
            dragDeadZone = 0,
            dragDeadTime = 0,
            draggableBehavior = false,
            onLoad = null,
            onMouseOver = null,
            onMouseLeave = null,
            onTargetLeave = null,
            onTargetEnter = null,
            onVarTransmit = null,
            onInvTransmit = null,
            onStatTransmit = null,
            onTimer = null,
            onOp = null,
            onMouseRepeat = null,
            onClick = null,
            onClickRepeat = null,
            onRelease = null,
            onHold = null,
            onDrag = null,
            onDragComplete = null,
            onScrollWheel = null,
            onVarTransmitList = null,
            onInvTransmitList = null,
            onStatTransmitList = null,
        )

    private fun componentTypeV3(): UnpackedComponentType =
        UnpackedComponentType(
            internalName = "",
            internalId = 24248328,
            v3 = true,
            type = 5,
            buttonType = 0,
            contentType = 0,
            x = 138,
            y = 87,
            width = 17,
            height = 17,
            trans1 = 0,
            layer = -1,
            mouseOverRedirect = -1,
            cs1Comparisons = null,
            cs1ComparisonValues = null,
            cs1Instructions = null,
            scrollHeight = 0,
            hide = false,
            fill = false,
            textAlignH = 0,
            textAlignV = 0,
            textLineHeight = 0,
            textFont = -1,
            textShadow = false,
            secondaryText = "",
            colour1 = 0,
            colour2 = 0,
            mouseOverColour1 = 0,
            mouseOverColour2 = 0,
            graphic = 699,
            secondaryGraphic = -1,
            modelKind = 1,
            model = -1,
            secondaryModelKind = 1,
            secondaryModel = -1,
            modelAnim = -1,
            secondaryModelAnim = -1,
            modelZoom = 100,
            modelAngleX = 0,
            modelAngleY = 0,
            text = "",
            targetVerb = "",
            targetBase = "",
            events = 2,
            buttonText = "Ok",
            widthMode = 0,
            heightMode = 0,
            xMode = 0,
            yMode = 0,
            scrollWidth = 0,
            noClickThrough = false,
            angle2d = 0,
            tiling = false,
            outline = 0,
            graphicShadow = 0,
            vFlip = false,
            hFlip = false,
            modelX = 0,
            modelY = 0,
            modelAngleZ = 0,
            modelOrthog = false,
            modelObjWidth = 0,
            lineWid = 1,
            lineDirection = false,
            opBase = "",
            op = arrayOf("On"),
            dragDeadZone = 0,
            dragDeadTime = 0,
            draggableBehavior = false,
            onLoad = arrayOf(1077, -2147483645, 24248329),
            onMouseOver = null,
            onMouseLeave = null,
            onTargetLeave = null,
            onTargetEnter = null,
            onVarTransmit = arrayOf(1077, -2147483645, 24248329),
            onInvTransmit = null,
            onStatTransmit = null,
            onTimer = null,
            onOp = arrayOf(1079, -2147483645, 24248329, 0),
            onMouseRepeat = null,
            onClick = null,
            onClickRepeat = null,
            onRelease = null,
            onHold = null,
            onDrag = null,
            onDragComplete = null,
            onScrollWheel = null,
            onVarTransmitList = intArrayOf(1047),
            onInvTransmitList = null,
            onStatTransmitList = null,
        )
}
